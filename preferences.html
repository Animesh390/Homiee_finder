<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>HOMIEE FINDER — Dashboard (Matches & Chat)</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Montserrat:wght@700&display=swap');
    :root{ --accent1:#6a11cb; --accent2:#2575fc; }
    *{box-sizing:border-box;margin:0;padding:0;font-family:'Poppins',sans-serif;color:#fff}
    body{
      min-height:100vh;
      background:url('https://images.pexels.com/photos/1643383/pexels-photo-1643383.jpeg') center/cover no-repeat;
      position:relative; display:flex; flex-direction:column;
    }
    .overlay{position:absolute;inset:0;background:rgba(0,0,0,0.45);z-index:0}
    .navbar{z-index:2;display:flex;justify-content:space-between;align-items:center;padding:18px 28px;position:relative}
    .logo{font-family:'Montserrat',sans-serif;font-weight:800;font-size:28px;background:linear-gradient(90deg,#ffefba,#fff);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
    .nav-actions{display:flex;gap:12px;align-items:center}
    .btn{padding:8px 12px;border-radius:8px;border:none;cursor:pointer;font-weight:600}
    .logout{background:linear-gradient(90deg,var(--accent1),var(--accent2));color:#fff}
    .edit-profile{background:#ffffff22;color:#fff;border:1px solid rgba(255,255,255,0.08)}
    .container{z-index:2;display:flex;gap:20px;padding:22px;flex-wrap:wrap}
    aside.left{width:300px;background:rgba(255,255,255,0.06);border:1px solid rgba(255,255,255,0.08);backdrop-filter:blur(8px);border-radius:12px;padding:18px;display:flex;flex-direction:column;align-items:center;gap:12px}
    .pfp{width:130px;height:130px;border-radius:50%;overflow:hidden;border:3px solid rgba(255,255,255,0.18);background:#fff}
    .pfp img{width:100%;height:100%;object-fit:cover;display:block}
    .name{font-weight:700;font-size:18px}
    .role{opacity:0.9;font-size:13px}
    .card{background:rgba(255,255,255,0.04);border:1px solid rgba(255,255,255,0.06);padding:14px;border-radius:10px}
    section.main{flex:1;display:flex;flex-direction:column;gap:16px}
    .grid{display:grid;grid-template-columns:1fr 360px;gap:16px}
    .match-list{display:grid;gap:12px}
    .match-card{display:flex;gap:12px;align-items:center;padding:12px;border-radius:10px;background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.04)}
    .match-card img{width:68px;height:68px;border-radius:10px;object-fit:cover;border:2px solid rgba(255,255,255,0.08)}
    .match-info{flex:1}
    .match-name{font-weight:700}
    .match-meta{font-size:13px;opacity:0.9}
    .match-actions{display:flex;flex-direction:column;gap:6px}
    .small-btn{padding:8px 10px;border-radius:8px;border:none;cursor:pointer;font-weight:600}
    .btn-view{background:#ffffff22;color:#fff}
    .btn-request{background:linear-gradient(90deg,var(--accent1),var(--accent2));color:#fff}
    .compat{font-weight:700;color:#fff;background:rgba(255,255,255,0.06);padding:6px 8px;border-radius:8px;font-size:13px}
    .side-col{display:flex;flex-direction:column;gap:12px}
    .requests {display:flex;flex-direction:column;gap:8px}
    .req-item{display:flex;justify-content:space-between;align-items:center;padding:10px;border-radius:8px;background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.04)}
    .status-pending{color:#ffd766;font-weight:700}
    .status-accepted{color:#90ee90;font-weight:700}
    .chat-modal{position:fixed;right:24px;bottom:24px;width:340px;height:420px;background:rgba(0,0,0,0.6);border-radius:12px;border:1px solid rgba(255,255,255,0.08);display:none;flex-direction:column;z-index:9999}
    .chat-head{display:flex;justify-content:space-between;align-items:center;padding:10px;border-bottom:1px solid rgba(255,255,255,0.04)}
    .chat-body{flex:1;padding:10px;overflow:auto;display:flex;flex-direction:column;gap:8px}
    .msg{max-width:80%;padding:8px 10px;border-radius:10px;background:rgba(255,255,255,0.06)}
    .msg.me{align-self:flex-end;background:linear-gradient(90deg,var(--accent1),var(--accent2));}
    .chat-input{display:flex;padding:10px;gap:8px;border-top:1px solid rgba(255,255,255,0.04)}
    .chat-input input{flex:1;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:transparent;color:#fff}
    .chat-input button{padding:8px 10px;border-radius:8px;border:none;background:linear-gradient(90deg,var(--accent1),var(--accent2));color:#fff;cursor:pointer}
    .filter-bar{
      display:flex;
      gap:12px;
      margin-bottom:12px;
      padding:12px;
      background:rgba(255,255,255,0.05);
      border:1px solid rgba(255,255,255,0.08);
      backdrop-filter:blur(8px);
      border-radius:10px;
      align-items:center;
    }
    .filter-bar .filt {
      padding: 10px 14px;
      border-radius: 8px;
      border: 1px solid rgba(255,255,255,0.15);
      background: rgba(255,255,255,0.08);
      color: #fff;
      backdrop-filter: blur(6px);
      font-size: 14px;
      outline: none;
      min-width:120px;
    }
    .filter-bar .filt option { color: #000; background:#fff; }
    @media(max-width:980px){ .grid{grid-template-columns:1fr} .side-col{order:2} aside.left{width:100%;flex-direction:row;justify-content:space-between;padding:12px} .pfp{width:72px;height:72px} .name{font-size:16px} .filter-bar{flex-direction:column;align-items:stretch} .filter-bar .filt{width:100%} }
  </style>
</head>
<body>
  <div class="overlay"></div>

  <div class="navbar">
    <div class="logo">HOMIEE FINDER</div>
    <div class="nav-actions">
      <button class="btn logout" onclick="logout()">Logout</button>
    </div>
  </div>

  <div class="container">
    <aside class="left">
      <div class="pfp"><img id="dashPfp" src="https://cdn-icons-png.flaticon.com/512/3135/3135715.png" alt="pfp"></div>
      <div class="name" id="dashName">Your Name</div>
      <div class="role" id="dashRole">Guest</div>
      <div style="width:100%;margin-top:8px">
        <div class="card">
         <h4 style="margin-bottom:8px">Contact</h4>
          <p id="dashEmail">Email: example@mail.com</p>
          <p id="dashMobile">Mobile: —</p>
        </div>
      </div>
    </aside>

    <section class="main">
      <div class="grid">
        <div>
          <div class="filter-bar">
            <select id="genderFilter" class="filt">
              <option value="Male">Male</option>
              <option value="Female">Female</option>
              <option value="">other</option>
            </select>
            <select id="foodFilter" class="filt">
              <option value="Veg">Veg</option>
              <option value="Non-Veg">Non-Veg</option>
              <option value="Both">Both</option>
            </select>
            <select id="languageFilter" class="filt">
              <option value="Hindi">Hindi</option>
              <option value="English">English</option>
              <option value="Bhojpuri">Bhojpuri</option>
              <option value="Marathi">Marathi</option>
              <option value="Tamil">Tamil</option>
              <option value="Bengali">Bengali</option>

            </select>
          </div>

          <div class="card" style="margin-bottom:12px">
            <h3 style="margin-bottom:10px">Matches Based on Preferences</h3>
            <div id="matches" class="match-list"></div>
          </div>

          <div class="card">
            <h3 style="margin-bottom:8px">Recent Activity</h3>
            <p id="activity" style="opacity:0.9">No activity yet.</p>
          </div>
        </div>

        <div class="side-col">
          <div class="card">
            <h4 style="margin-bottom:8px">Chat Requests</h4>
            <div>
              <h5 style="margin:6px 0 8px 0">Pending</h5>
              <div id="pendingList" class="requests"></div>
            </div>
            <div style="margin-top:10px">
              <h5 style="margin:6px 0 8px 0">Accepted</h5>
              <div id="acceptedList" class="requests"></div>
            </div>
            <div style="margin-top:10px">
              <h5 style="margin:6px 0 8px 0">Sent Requests</h5>
              <div id="sentList" class="requests"></div>
            </div>
          </div>
        </div>
      </div>
    </section>
  </div>

  <div class="chat-modal" id="chatModal" aria-hidden="true">
    <div class="chat-head">
      <div id="chatTitle">Chat</div>
      <div><button class="btn" onclick="closeChat()">Close</button></div>
    </div>
    <div class="chat-body" id="chatBody"></div>
    <div class="chat-input">
      <input id="chatInp" placeholder="Type a message...">
      <button onclick="sendChat()">Send</button>
    </div>
  </div>

  <script>
const meKey = 'homiee_profile';
if(!localStorage.getItem(meKey)){
  const initial = {
    name: "You", email: "you@example.com", mobile: "", role: "Guest",
    pfp: "", food: "Veg", smoke: "No", drink: "No", clean:5, social:5,
    interests: ["Travel","Movies","Music"], languages: ["Hindi","English"],
    city: "YourCity", age: "22", bio: "Hello, I'm using Homiee Finder."
  };
  localStorage.setItem(meKey, JSON.stringify(initial));
}

const othersKey = 'homiee_others';
if(!localStorage.getItem(othersKey)){
  const sample = [
    { id:'u1', name:'Aman', age:23, city:'Lucknow', role:'Guest', pfp:'https://images.pexels.com/photos/220453/pexels-photo-220453.jpeg', food:'Veg', gender:'Male', smoke:'No', drink:'No', clean:7, social:6, interests:['Travel','Music','Cooking'], languages:['Hindi','English'], bio:'Easygoing, loves travel.'},
    { id:'u2', name:'Riya', age:21, city:'Delhi', role:'Guest', pfp:'https://images.pexels.com/photos/415829/pexels-photo-415829.jpeg', food:'Non-Veg', gender:'Female', smoke:'No', drink:'Yes', clean:6, social:8, interests:['Gym','Music','Movies'], languages:['English','Hindi'], bio:'Fitness freak and foodie.'},
    { id:'u3', name:'Sameer', age:24, city:'Lucknow', role:'Owner', pfp:'https://images.pexels.com/photos/1183266/pexels-photo-1183266.jpeg', food:'Both', gender:'Male', smoke:'No', drink:'No', clean:8, social:4, interests:['Reading','Music','Travel'], languages:['Hindi'], bio:'Quiet, like reading.'},
    { id:'u4', name:'Priya', age:22, city:'Lucknow', role:'Guest', pfp:'https://images.pexels.com/photos/774909/pexels-photo-774909.jpeg', food:'Veg', gender:'Female', smoke:'No', drink:'No', clean:5, social:7, interests:['Cooking','Travel','Dancing'], languages:['Hindi','English'], bio:'Loves cooking and dance.'}
  ];
  localStorage.setItem(othersKey, JSON.stringify(sample));
}

const reqKey = 'homiee_requests';
if(!localStorage.getItem(reqKey)) localStorage.setItem(reqKey, JSON.stringify([]));

const chatKey = 'homiee_chats';
if(!localStorage.getItem(chatKey)) localStorage.setItem(chatKey, JSON.stringify({}));

function loadMe(){ return JSON.parse(localStorage.getItem(meKey) || '{}'); }
function loadOthers(){ return JSON.parse(localStorage.getItem(othersKey) || '[]'); }
function loadReq(){ return JSON.parse(localStorage.getItem(reqKey) || '[]'); }
function saveReq(arr){ localStorage.setItem(reqKey, JSON.stringify(arr)); }
function loadChats(){ return JSON.parse(localStorage.getItem(chatKey) || '{}'); }
function saveChats(obj){ localStorage.setItem(chatKey, JSON.stringify(obj)); }

function compatibilityScore(me, other){
  let score = 0;
  const mi = me.interests || []; const oi = other.interests || [];
  const common = mi.filter(x=> oi.includes(x)).length;
  const maxInterest = Math.max(mi.length, oi.length, 1);
  score += Math.round((common / maxInterest) * 40);
  if(me.city && other.city && me.city.toLowerCase() === other.city.toLowerCase()) score += 10;
  if(me.food && other.food && (me.food === other.food || me.food === 'Both' || other.food === 'Both')) score += 10;
  if(me.smoke && other.smoke && (me.smoke === other.smoke)) score += 10;
  const diffClean = Math.abs((me.clean||5) - (other.clean||5));
  score += Math.max(0, 10 - diffClean*2);
  const diffSocial = Math.abs((me.social||5) - (other.social||5));
  score += Math.max(0, 10 - diffSocial*2);
  if(score>100) score=100;
  return score;
}

function renderSingleMatch(user, me){
  const score = compatibilityScore(me, user);
  const div = document.createElement('div');
  div.className = 'match-card';
  div.innerHTML = `
    <img src="${user.pfp}" alt="">
    <div class="match-info">
      <div class="match-name">${user.name}, ${user.age}</div>
      <div class="match-meta">${user.city} • ${user.role} • ${user.bio}</div>
    </div>
    <div style="display:flex;flex-direction:column;gap:8px;align-items:flex-end">
      <div class="compat">${score}%</div>
      <div class="match-actions">
        <button class="small-btn btn-view" onclick="viewProfile('${user.id}')">View</button>
        <button class="small-btn btn-request" onclick="sendRequest('${user.id}')">Send Request</button>
      </div>
    </div>
  `;
  document.getElementById('matches').appendChild(div);
}

function renderMatches(){
  const me = loadMe();
  const others = loadOthers();
  const scored = others.map(o => ({...o, score: compatibilityScore(me,o)}));
  scored.sort((a,b)=> b.score - a.score);
  const wrapper = document.getElementById('matches');
  wrapper.innerHTML = '';
  scored.forEach(user=> renderSingleMatch(user, me));
}

/* ===== FULL WORKING FILTER ===== */
function applyFilters(){
  const gender = document.getElementById("genderFilter").value;
  const food = document.getElementById("foodFilter").value;
  const lang = document.getElementById("languageFilter").value;

  const me = loadMe();
  let others = loadOthers();

  others = others.filter(o => {
    let genderMatch = gender === "" || o.gender === gender;
    let foodMatch = food === "" || o.food === food || o.food === 'Both' || food === 'Both';
    let langMatch = lang === "" || (o.languages && o.languages.includes(lang));
    return genderMatch && foodMatch && langMatch;
  });

  const scored = others.map(o => ({...o, score: compatibilityScore(me,o)}));
  scored.sort((a,b)=> b.score
